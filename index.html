// GANTI SEMUA KODE <script>...</script> LAMA DENGAN KODE INI

const quizData = [
    {
        question: "Saat jam istirahat, Budi melihat temannya, Wayan, sedang berdoa di sudut kelas sebelum makan bekalnya. Di saat yang sama, beberapa teman lain mengajak Budi untuk segera bermain kejar-kejaran di dalam kelas. Sikap terbaik yang seharusnya Budi lakukan yang mencerminkan nilai sila pertama dan kedua Pancasila sekaligus adalah...",
        options: [
            "Ikut bermain kejar-kejaran karena itu adalah haknya untuk bermain saat istirahat.",
            "Mengajak teman-teman lain untuk bermain di luar kelas agar tidak mengganggu Wayan yang sedang berdoa.",
            "Menegur Wayan agar berdoa lebih cepat karena mengganggu teman-teman yang ingin bermain.",
            "Diam saja dan menunggu Wayan selesai berdoa, baru kemudian ikut bermain di dalam kelas."
        ],
        answer: 1,
        analysis: "Pilihan ini menunjukkan sikap <strong>menghormati orang beribadah (Sila 1)</strong> dan <strong>menjaga perasaan serta hak orang lain (Sila 2)</strong> dengan cara yang solutif. Pilihan lain hanya fokus pada satu aspek atau bahkan melanggar nilai Pancasila."
    },
    {
        question: "Siti ingin membuat sebuah patung hewan (kura-kura) yang memiliki detail ukiran yang sangat halus pada bagian tempurungnya. Ia memiliki beberapa pilihan bahan. Agar hasil karyanya paling sesuai dengan yang diinginkan, bahan yang sebaiknya Siti pilih adalah...",
        options: [
            "Tanah liat, karena mudah didapat dan merupakan bahan tradisional.",
            "Adonan plastisin, karena paling mudah dibentuk dan memiliki banyak pilihan warna.",
            "Lilin malam, karena sifatnya yang lunak namun padat sehingga detail kecil tidak mudah hancur saat diukir.",
            "Adonan tepung, karena merupakan bahan yang paling murah dan ramah lingkungan."
        ],
        answer: 2,
        analysis: "Siswa harus menganalisis properti dari setiap bahan. <strong>Lilin malam</strong> adalah jawaban terbaik karena kepadatannya mendukung ukiran halus lebih baik daripada plastisin yang terlalu lunak atau tanah liat yang bisa retak jika tidak diolah dengan benar. Ini menguji kemampuan analisis dan pengambilan keputusan."
    },
    {
        question: "Di lingkungan sekitar rumahmu, akan diadakan kerja bakti. Namun, salah satu tetanggamu yang beragama lain tidak bisa ikut karena harus pergi ke tempat ibadah pada jam yang bersamaan. Sebagai warga yang baik, tindakan yang paling bijaksana untuk menunjukkan penerapan sila kedua adalah...",
        options: [
            "Memaksa tetangga tersebut untuk tetap ikut kerja bakti demi menjaga persatuan.",
            "Mengizinkannya untuk beribadah dan menawarkan agar ia dapat berkontribusi di lain waktu atau dengan cara lain.",
            "Melaporkannya kepada ketua RT karena dianggap tidak memiliki rasa solidaritas.",
            "Menganggapnya tidak peduli pada lingkungan dan tidak mengajaknya bicara lagi."
        ],
        answer: 1,
        analysis: "Soal ini menguji kemampuan evaluasi. Pilihan ini menunjukkan pemahaman mendalam tentang <strong>hak asasi (beribadah)</strong> dan <strong>solidaritas (menawarkan kontribusi lain)</strong>, yang merupakan inti dari sila kedua 'Kemanusiaan yang Adil dan Beradab'. Pilihan lain menunjukkan sikap intoleran atau tidak solutif."
    },
    {
        question: "Perhatikan dua teknik membuat patung berikut: <br>1) <strong>Teknik Butsir:</strong> Menambah dan mengurangi bahan sedikit demi sedikit menggunakan sudip.<br>2) <strong>Teknik Pahat:</strong> Mengurangi bahan secara bertahap menggunakan alat pahat.<br>Perbedaan mendasar yang paling tepat antara kedua teknik tersebut dalam proses penciptaan bentuk adalah...",
        options: [
            "Teknik butsir hanya bisa untuk bahan keras, sedangkan teknik pahat untuk bahan lunak.",
            "Teknik butsir memungkinkan adanya penambahan bahan jika terjadi kesalahan, sedangkan teknik pahat tidak.",
            "Teknik butsir tidak memerlukan alat, sedangkan teknik pahat memerlukan alat khusus.",
            "Teknik butsir menghasilkan patung yang lebih besar daripada teknik pahat."
        ],
        answer: 1,
        analysis: "Soal ini memerlukan analisis perbandingan. Perbedaan paling fundamental adalah sifat prosesnya: butsir bersifat <i>aditif</i> (bisa menambah) dan <i>subtraktif</i> (mengurangi), sedangkan pahat murni <i>subtraktif</i>. Kemampuan untuk <strong>'menambah bahan'</strong> adalah konsekuensi logis dari perbedaan ini."
    },
    {
        question: "Kelas VI mendapat tugas kelompok membuat diorama patung kerukunan umat beragama. Setiap kelompok terdiri dari siswa dengan latar belakang agama yang berbeda. Tantangan utama yang paling mungkin dihadapi yang berkaitan dengan penerapan nilai Pancasila adalah...",
        options: [
            "Kesulitan teknis dalam membentuk patung dari tanah liat agar tidak mudah retak.",
            "Menentukan simbol-simbol keagamaan yang akan dibuat patungnya tanpa menyinggung perasaan anggota kelompok lain.",
            "Kurangnya dana untuk membeli cat akrilik untuk mewarnai patung-patung.",
            "Perbedaan pendapat mengenai siapa yang paling ahli dalam membuat patung di kelompok."
        ],
        answer: 1,
        analysis: "Ini adalah soal analisis-kontekstual. Tantangan utamanya bukan pada teknis (A, C, D), melainkan pada aspek sosial. Menentukan simbol yang representatif dan dapat diterima semua anggota kelompok adalah tantangan yang langsung menguji nilai <strong>toleransi (Sila 1)</strong>, <strong>musyawarah</strong>, dan <strong>menghargai sesama (Sila 2)</strong>."
    }
];

const questionContainer = document.getElementById('question-container');
const prevBtn = document.getElementById('prev-btn');
const nextBtn = document.getElementById('next-btn');
const progressBar = document.getElementById('progress-bar');
const questionCounter = document.getElementById('question-counter');
const scoreDisplay = document.getElementById('score-display');
const quizArea = document.getElementById('quiz-area');
const summaryArea = document.getElementById('summary-area');
const finalScoreEl = document.getElementById('final-score');
const finalFeedbackEl = document.getElementById('final-feedback');
const restartBtn = document.getElementById('restart-btn');

let currentQuestionIndex = 0;
let userAnswers = new Array(quizData.length).fill(null);
let score = 0;
let studentName = '';

function renderQuestion(index) {
    const questionData = quizData[index];
    const isAnswered = userAnswers[index] !== null;

    let optionsHTML = '';
    questionData.options.forEach((option, i) => {
        let optionClass = 'quiz-option bg-gray-50 border border-gray-300 rounded-lg p-4 flex items-center space-x-4';
        if (isAnswered) {
            optionClass += ' disabled';
            if (i === questionData.answer) {
                optionClass += ' correct';
            } else if (i === userAnswers[index]) {
                optionClass += ' incorrect';
            }
        }
        optionsHTML += `
            <div id="option-${index}-${i}" class="${optionClass}" onclick="selectAnswer(${index}, ${i})">
                <span class="font-bold text-gray-600">${String.fromCharCode(65 + i)}</span>
                <p class="flex-1">${option}</p>
            </div>
        `;
    });

    questionContainer.innerHTML = `
        <div class="bg-white p-6 rounded-lg">
            <p class="text-lg md:text-xl text-gray-800 leading-relaxed mb-6">${questionData.question}</p>
            <div class="space-y-4">${optionsHTML}</div>
            <div id="analysis-${index}" class="analysis-card mt-6 bg-blue-50 border-l-4 border-blue-400 p-4 rounded-r-lg">
                <h3 class="font-bold text-blue-800 mb-2">Analisis Jawaban</h3>
                <p class="text-blue-900 text-sm leading-relaxed">${questionData.analysis}</p>
            </div>
        </div>
    `;
    
    if (isAnswered) {
        document.getElementById(`analysis-${index}`).classList.add('show');
    }

    updateUI();
}

function selectAnswer(qIndex, aIndex) {
    if (userAnswers[qIndex] !== null) return; 

    userAnswers[qIndex] = aIndex;
    const questionData = quizData[qIndex];
    const isCorrect = aIndex === questionData.answer;

    if (isCorrect) {
        score++;
    }

    const optionsContainer = questionContainer.querySelector('.space-y-4');
    Array.from(optionsContainer.children).forEach((optionEl, i) => {
        optionEl.classList.add('disabled');
        if (i === questionData.answer) {
            optionEl.classList.add('correct');
        } else if (i === aIndex) {
            optionEl.classList.add('incorrect');
        }
    });

    document.getElementById(`analysis-${qIndex}`).classList.add('show');
    updateUI();
}

function updateUI() {
    questionCounter.textContent = `Soal ${currentQuestionIndex + 1} dari ${quizData.length}`;
    scoreDisplay.textContent = `Skor: ${score * 20}`;
    progressBar.style.width = `${((currentQuestionIndex + 1) / quizData.length) * 100}%`;
    
    prevBtn.disabled = currentQuestionIndex === 0;
    nextBtn.disabled = userAnswers[currentQuestionIndex] === null;
    
    if (currentQuestionIndex === quizData.length - 1) {
        if (userAnswers[currentQuestionIndex] !== null) {
            nextBtn.textContent = 'Lihat Hasil';
            nextBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
            nextBtn.classList.add('bg-green-600', 'hover:bg-green-700');
        }
    } else {
        nextBtn.textContent = 'Selanjutnya';
        nextBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
        nextBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
    }
}

function submitToGoogleForm(name, finalScore) {
    const formUrl = "https://docs.google.com/forms/u/0/d/e/1FAIpQLSdKVYwwTrB-AqVNGEXBlfzFyYFOQhtT2vo6uarwFHzZA6YFcw/formResponse
"; 
    const nameEntryId = "entry.283058117"; 
    const scoreEntryId = "entry.1692873695"; 

    const formData = new FormData();
    formData.append(nameEntryId, name);
    formData.append(scoreEntryId, finalScore);

    fetch(formUrl, {
        method: 'POST',
        body: formData,
        mode: 'no-cors' 
    }).catch(error => console.error('Error!', error.message));
}

function showSummary() {
    quizArea.classList.add('hidden');
    summaryArea.classList.remove('hidden');
    const finalScore = score * 20;
    finalScoreEl.textContent = finalScore;

    let feedback = '';
    if (finalScore === 100) {
        feedback = 'Luar biasa! Pemahamanmu sangat baik.';
    } else if (finalScore >= 80) {
        feedback = 'Bagus sekali! Kamu sudah menguasai sebagian besar materi.';
    } else if (finalScore >= 60) {
        feedback = 'Cukup baik. Terus belajar untuk lebih paham lagi ya.';
    } else {
        feedback = 'Jangan menyerah! Coba ulangi dan pelajari lagi analisis jawabannya.';
    }
    finalFeedbackEl.textContent = feedback;

    submitToGoogleForm(studentName, finalScore);
}

function startQuiz() {
    studentName = prompt("Silakan masukkan nama lengkap Anda:", "");
    if (studentName && studentName.trim() !== "") {
        renderQuestion(currentQuestionIndex);
    } else {
        alert("Nama tidak boleh kosong untuk memulai penilaian.");
    }
}

nextBtn.addEventListener('click', () => {
    if (userAnswers[currentQuestionIndex] === null) return;
    if (currentQuestionIndex < quizData.length - 1) {
        currentQuestionIndex++;
        renderQuestion(currentQuestionIndex);
    } else {
        showSummary();
    }
});

prevBtn.addEventListener('click', () => {
    if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        renderQuestion(currentQuestionIndex);
    }
});

restartBtn.addEventListener('click', () => {
    currentQuestionIndex = 0;
    userAnswers.fill(null);
    score = 0;
    summaryArea.classList.add('hidden');
    quizArea.classList.remove('hidden');
    startQuiz();
});

document.addEventListener('DOMContentLoaded', () => {
    startQuiz();
});
